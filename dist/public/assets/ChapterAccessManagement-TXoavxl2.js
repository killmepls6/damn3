import{j as e}from"./ui-vendor-BpIggZZ9.js";import{b as a}from"./react-vendor-C7VPsBAG.js";import{c as xe,P as pe,C as $,f as q,g as V,h as O,i as M,B as d,a9 as je,$ as ge,p as x,m as N,n as b,I as H,a5 as z}from"./index-Bshoxa3b.js";import{C as fe}from"./checkbox-CKseajx-.js";import{D as G,a as J,b as K,c as Q,d as W,e as X}from"./dialog-B4soTW2z.js";import{S as w,a as A,b as T,c as U,d as i}from"./select-DT_5i3rD.js";import{S as ve}from"./square-Br1AVrZR.js";import{S as ke}from"./square-check-big-DgO1Q1Lh.js";import{D}from"./dollar-sign-c3-1CJgR.js";import"./utils-vendor-BUCX3MvZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=xe("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);function Fe(){const{toast:c}=pe(),[p,Y]=a.useState(""),[L,Z]=a.useState([]),[n,_]=a.useState([]),[h,ee]=a.useState(null),[se,j]=a.useState(!1),[o,g]=a.useState("free"),[P,f]=a.useState("0"),[l,v]=a.useState([]),[te,k]=a.useState(!1),[u,E]=a.useState("free"),[B,I]=a.useState("0"),[C,R]=a.useState(!1),ae=async()=>{R(!0);try{const s=await fetch("/api/series",{credentials:"include"});if(s.ok){const t=await s.json();Z(t)}}catch{}finally{R(!1)}};a.useEffect(()=>{ae()},[]);const S=async()=>{if(!p.trim()){c({title:"Error",description:"Please select a series",variant:"destructive"});return}try{const s=await fetch(`/api/series/${p}/chapters`,{credentials:"include"});if(!s.ok)throw new Error("Series not found");const t=await s.json();_(t),c({title:"Series Loaded",description:`Found ${t.length} chapters`})}catch(s){c({title:"Error",description:s.message||"Failed to load series",variant:"destructive"})}},ce=async s=>{ee(s);try{const t=await fetch(`/api/chapters/${s.id}/access`,{credentials:"include"});if(t.ok){const r=await t.json();g(r.accessType||"free"),f((r.unlockCost||0).toString())}else g("free"),f("0")}catch{g("free"),f("0")}j(!0)},re=async()=>{if(!h)return;const s=o==="free"?0:parseInt(P);if(o!=="free"&&(!s||s<0)){c({title:"Error",description:"Please enter a valid unlock cost for non-free chapters",variant:"destructive"});return}try{await z("POST",`/api/admin/chapters/${h.id}/access`,{accessType:o,unlockCost:s}),S(),j(!1),c({title:"Access Updated",description:`Chapter access set to ${o}`})}catch(t){c({title:"Error",description:t.message||"Failed to update access",variant:"destructive"})}},le=s=>{v(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},ie=()=>{l.length===n.length?v([]):v(n.map(s=>s.id))},ne=async()=>{if(l.length===0){c({title:"Error",description:"Please select at least one chapter",variant:"destructive"});return}const s=u==="free"?0:parseInt(B);if(u!=="free"&&(!s||s<0)){c({title:"Error",description:"Please enter a valid unlock cost for non-free chapters",variant:"destructive"});return}try{const t=await z("POST","/api/admin/chapters/bulk-access",{chapterIds:l,accessType:u,unlockCost:s});if(S(),k(!1),v([]),E("free"),I("0"),t.failureCount>0){const r=t.results.filter(m=>!m.success),y=r.slice(0,3),oe=r.length>3;c({title:"Partial Success",description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:t.message}),e.jsxs("div",{className:"text-xs mt-2 space-y-1",children:[e.jsx("p",{className:"font-semibold",children:"Failed chapters:"}),y.map((m,he)=>{const ue=n.find(me=>me.id===m.chapterId);return e.jsxs("p",{children:["â€¢ Chapter ",ue?.chapterNumber||m.chapterId,": ",m.error]},he)}),oe&&e.jsxs("p",{className:"text-muted-foreground",children:["...and ",r.length-3," more"]})]})]}),variant:"default"})}else c({title:"Bulk Update Complete",description:t.message})}catch(t){const r=t.message||"Failed to update chapters",y=r.includes("Invalid input");c({title:y?"Validation Error":"Update Failed",description:r,variant:"destructive"})}},de=s=>{switch(s){case"free":return e.jsxs(x,{variant:"secondary",children:[e.jsx(F,{className:"w-3 h-3 mr-1"})," Free"]});case"premium":return e.jsxs(x,{className:"bg-primary",children:[e.jsx(D,{className:"w-3 h-3 mr-1"})," Premium"]});case"locked":return e.jsxs(x,{variant:"destructive",children:[e.jsx(b,{className:"w-3 h-3 mr-1"})," Locked"]});default:return e.jsx(x,{variant:"outline",children:"Unknown"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Chapter Access Control"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage chapter pricing and access types (free, premium, locked)"})]}),e.jsxs($,{children:[e.jsxs(q,{children:[e.jsx(V,{children:"Select Series"}),e.jsx(O,{children:"Choose a series to manage chapter access and pricing"})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(w,{value:p,onValueChange:Y,disabled:C,children:[e.jsx(A,{children:e.jsx(T,{placeholder:C?"Loading series...":"Select a series..."})}),e.jsxs(U,{children:[L.length===0&&!C&&e.jsx(i,{value:"none",disabled:!0,children:"No series available"}),L.map(s=>e.jsx(i,{value:s.id,children:s.title},s.id))]})]})}),e.jsxs(d,{onClick:S,disabled:!p||C,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Load Chapters"]})]})})]}),n.length>0&&e.jsxs($,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(V,{children:["Chapters (",n.length,")"]}),e.jsx(O,{children:"Select chapters for bulk actions or click to edit individually"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:ie,children:l.length===n.length?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Select All"]})}),l.length>0&&e.jsxs(d,{onClick:()=>k(!0),children:["Bulk Update (",l.length,")"]})]})]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border border-border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx(fe,{checked:l.includes(s.id),onCheckedChange:()=>le(s.id),onClick:t=>t.stopPropagation()}),e.jsxs("div",{className:"flex-1 flex items-center justify-between cursor-pointer",onClick:()=>ce(s),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:["Chapter ",s.chapterNumber,": ",s.title||"Untitled"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.pages?.length||0," pages"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.accessType&&de(s.accessType),s.unlockCost>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ge,{className:"w-4 h-4"}),s.unlockCost]}),e.jsx(x,{variant:s.isPublished==="true"?"default":"secondary",children:s.isPublished==="true"?"Published":"Draft"})]})]})]},s.id))})})]}),e.jsx(G,{open:se,onOpenChange:j,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Set Chapter Access"}),e.jsx(W,{children:h&&`Chapter ${h.chapterNumber}: ${h.title||"Untitled"}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"accessType",children:"Access Type"}),e.jsxs(w,{value:o,onValueChange:g,children:[e.jsx(A,{id:"accessType",children:e.jsx(T,{})}),e.jsxs(U,{children:[e.jsx(i,{value:"free",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Free - Available to all users"]})}),e.jsx(i,{value:"premium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Premium - Requires coins to unlock"]})}),e.jsx(i,{value:"locked",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Locked - Restricted access"]})})]})]})]}),o!=="free"&&e.jsxs("div",{children:[e.jsx(N,{htmlFor:"unlockCost",children:"Unlock Cost (Coins)"}),e.jsx(H,{id:"unlockCost",type:"number",placeholder:"Enter cost in coins",value:P,onChange:s=>f(s.target.value),min:"0"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Users will need to spend this many coins to unlock this chapter"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Access Types Explained:"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Free:"})," Available to all users"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Premium:"})," Requires coins, one-time unlock"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Locked:"})," Restricted, requires special access"]})]})]})]}),e.jsxs(X,{children:[e.jsx(d,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{onClick:re,children:"Update Access"})]})]})}),e.jsx(G,{open:te,onOpenChange:k,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Bulk Update Access"}),e.jsxs(W,{children:["Update access type for ",l.length," selected chapters"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"bulkAccessType",children:"Access Type"}),e.jsxs(w,{value:u,onValueChange:E,children:[e.jsx(A,{id:"bulkAccessType",children:e.jsx(T,{})}),e.jsxs(U,{children:[e.jsx(i,{value:"free",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Free - Available to all users"]})}),e.jsx(i,{value:"premium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Premium - Requires coins to unlock"]})}),e.jsx(i,{value:"locked",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Locked - Restricted access"]})})]})]})]}),u!=="free"&&e.jsxs("div",{children:[e.jsx(N,{htmlFor:"bulkUnlockCost",children:"Unlock Cost (Coins)"}),e.jsx(H,{id:"bulkUnlockCost",type:"number",placeholder:"Enter cost in coins",value:B,onChange:s=>I(s.target.value),min:"0"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"All selected chapters will use this unlock cost"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Selected Chapters: ",l.length]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This will update the access type and unlock cost for all selected chapters"})]})]}),e.jsxs(X,{children:[e.jsx(d,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(d,{onClick:ne,children:"Update All"})]})]})})]})}export{Fe as default};
