import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as $,b as n,L as B}from"./react-vendor-C7VPsBAG.js";import{u as V,t,B as p,a8 as W,C as U,i as k,a9 as z,I as x,f as J,g as Q,p as h,h as G,A as K,j as Y,k as Z,U as T,M as _,m as j,aa as ee,T as se,a3 as ae,V as re}from"./index-Bshoxa3b.js";import{D as te,f as ie,a as ne,b as le,c as ce,d as de}from"./dialog-B4soTW2z.js";import{A as oe,a as me,b as xe,c as he,d as ue,e as pe,f as je,g as fe}from"./alert-dialog-ckVHmtNn.js";import{S as ge,a as Ne,b as ve,c as we,d as f}from"./select-DT_5i3rD.js";import{U as be}from"./users-q6XJjClA.js";import{M as ye}from"./map-pin-DjCNlwfX.js";import{C as Ce}from"./calendar-ByILsbL3.js";import{S as Se}from"./square-pen-C7u-hRzu.js";import{S as Ue}from"./save-B39N0M5_.js";import{C as M}from"./crown-DnGdiNOO.js";import"./utils-vendor-BUCX3MvZ.js";function Re(){const{isAdmin:i,isAuthenticated:v,user:g,isOwner:l,isStaff:d}=V(),[,A]=$(),[N,D]=n.useState([]),[O,E]=n.useState(!0),[o,P]=n.useState(""),[L,w]=n.useState(null),[m,c]=n.useState({}),[b,y]=n.useState(null);n.useEffect(()=>{(!v||!i)&&A("/")},[v,i,A]),n.useEffect(()=>{C()},[]);const C=async()=>{try{E(!0);const s=await fetch("/api/admin/users",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(s.ok){const a=await s.json();D(a)}else t({title:"Error",description:"Failed to fetch users",variant:"destructive"})}catch{t({title:"Error",description:"Failed to fetch users",variant:"destructive"})}finally{E(!1)}},q=s=>{w(s),c({username:s.username,email:s.email,firstName:s.firstName,lastName:s.lastName,country:s.country})},X=async()=>{if(L)try{const s=await fetch(`/api/admin/users/${L.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(m)});if(s.ok)t({title:"Success",description:"User updated successfully"}),w(null),c({}),C();else{const a=await s.json();t({title:"Error",description:a.message||"Failed to update user",variant:"destructive"})}}catch{t({title:"Error",description:"Failed to update user",variant:"destructive"})}},H=async s=>{try{const a=await fetch(`/api/admin/users/${s}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest"}});if(a.ok)t({title:"Success",description:"User deleted successfully"}),y(null),C();else{const r=await a.json();t({title:"Error",description:r.message||"Failed to delete user",variant:"destructive"})}}catch{t({title:"Error",description:"Failed to delete user",variant:"destructive"})}},R=async(s,a)=>{try{const r=await fetch(`/api/admin/users/${s}/role`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({role:a})});if(r.ok){const u=await r.json();D(N.map(S=>S.id===s?{...S,role:a,isAdmin:a==="admin"||a==="owner"}:S)),t({title:"Success",description:`User role changed to ${a}.`})}else{const u=await r.json();throw new Error(u.message||"Failed to update role")}}catch(r){t({title:"Error",description:r instanceof Error?r.message:"Failed to update user role. Please try again.",variant:"destructive"})}},I=(s,a)=>{switch(s||(a?"admin":"user")){case"owner":return e.jsxs(h,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white border-2 border-yellow-300 shadow-lg",children:[e.jsx(M,{className:"w-3 h-3 mr-1 fill-current"}),"Owner"]});case"admin":return e.jsxs(h,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Admin"]});case"staff":return e.jsxs(h,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Staff"]});case"premium":return e.jsxs(h,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Premium"]});case"user":default:return e.jsxs(h,{variant:"secondary",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"User"]})}},F=N.filter(s=>s.username?.toLowerCase().includes(o.toLowerCase())||s.email?.toLowerCase().includes(o.toLowerCase())||s.firstName?.toLowerCase().includes(o.toLowerCase())||s.lastName?.toLowerCase().includes(o.toLowerCase()));return!v||!i?null:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(B,{href:"/admin",children:e.jsxs(p,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-primary",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Admin Panel"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"User Management"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(U,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search users by username, email, or name...",value:o,onChange:s=>P(s.target.value),className:"pl-10 bg-background/50"})]})})})}),e.jsx(U,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:N.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})})})]}),e.jsxs(U,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(J,{children:[e.jsxs(Q,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"All Users"}),d&&!l&&!i&&e.jsx(h,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500 text-xs",children:"Read-only (Staff)"})]}),e.jsx(G,{children:d&&!l&&!i?"View user information (Staff have read-only access)":"Manage user accounts and permissions"})]}),e.jsx(k,{children:O?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})}):F.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:o?"No users found matching your search.":"No users found."})}):e.jsx("div",{className:"space-y-4",children:F.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background/50 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(K,{className:"w-12 h-12",children:[e.jsx(Y,{src:s.profileImageUrl||s.profilePicture||void 0}),e.jsx(Z,{className:"bg-primary/10 text-primary",children:(s.firstName?.[0]||s.username?.[0]||"U").toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"font-medium truncate",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username||"No name"}),I(s.role,s.isAdmin)]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-sm text-muted-foreground",children:[s.username&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(T,{className:"w-3 h-3"}),e.jsx("span",{children:s.username})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-48",children:s.email})]}),s.country&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:s.country})]}),s.createdAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ge,{value:s.role||(s.isAdmin?"admin":"user"),disabled:!l,onValueChange:a=>{if(a==="owner"){if(g?.role!=="owner"){t({title:"Access Denied",description:"Only the current owner can assign owner privileges.",variant:"destructive"});return}if(N.find(u=>u.role==="owner"&&u.id!==s.id)){t({title:"Error",description:"Only one owner can exist at a time. Please demote the current owner first.",variant:"destructive"});return}}if(g?.id===s.id&&g?.role==="owner"&&a!=="owner"){t({title:"Access Denied",description:"Owners cannot demote themselves. Transfer ownership to another user first.",variant:"destructive"});return}R(s.id,a)},children:[e.jsx(Ne,{className:"w-24 h-8 text-xs",children:e.jsx(ve,{})}),e.jsxs(we,{children:[e.jsx(f,{value:"user",children:"User"}),e.jsx(f,{value:"premium",children:"Premium"}),e.jsx(f,{value:"staff",children:"Staff"}),e.jsx(f,{value:"admin",children:"Admin"}),g?.role==="owner"&&e.jsx(f,{value:"owner",children:"Owner"})]})]}),e.jsxs(te,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(p,{variant:"outline",size:"sm",onClick:()=>q(s),disabled:d&&!l&&!i,title:d&&!l&&!i?"Staff have read-only access":"Edit user",children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsxs(ne,{className:"sm:max-w-[525px]",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Edit User"}),e.jsx(de,{children:"Update user information and settings."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"firstName",children:"First Name"}),e.jsx(x,{id:"firstName",value:m.firstName||"",onChange:a=>c(r=>({...r,firstName:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"lastName",children:"Last Name"}),e.jsx(x,{id:"lastName",value:m.lastName||"",onChange:a=>c(r=>({...r,lastName:a.target.value})),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"username",children:"Username"}),e.jsx(x,{id:"username",value:m.username||"",onChange:a=>c(r=>({...r,username:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(x,{id:"email",type:"email",value:m.email||"",onChange:a=>c(r=>({...r,email:a.target.value})),className:"bg-background/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"country",children:"Country"}),e.jsx(x,{id:"country",value:m.country||"",onChange:a=>c(r=>({...r,country:a.target.value})),className:"bg-background/50"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(p,{variant:"outline",onClick:()=>w(null),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(p,{onClick:X,children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})]}),!s.isAdmin&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>y(s.id),className:"text-destructive hover:text-destructive",disabled:d&&!l&&!i,title:d&&!l&&!i?"Staff have read-only access":"Delete user",children:e.jsx(se,{className:"w-4 h-4"})})]})]},s.id))})})]}),e.jsx(oe,{open:!!b,onOpenChange:()=>y(null),children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Delete User"}),e.jsx(ue,{children:"Are you sure you want to delete this user? This action cannot be undone."})]}),e.jsxs(pe,{children:[e.jsx(je,{children:"Cancel"}),e.jsx(fe,{onClick:()=>b&&H(b),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete User"})]})]})})]})})}export{Re as default};
