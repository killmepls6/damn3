import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as P,b as C,L as M}from"./react-vendor-C7VPsBAG.js";import{u as I,b as $,B as p,ag as k,a8 as q,C as r,i,e as b,a7 as A,f as c,g as o,h as m,a3 as _,t as g}from"./index-Bshoxa3b.js";import{L as H,P as V,B as D,C as Z,a as K,b as W,c as X,d as z,e as J,A as Q,p as Y,f as ee,g as se}from"./chart-vendor-BWHaG5wj.js";import{A as R}from"./activity-r2qUXDVk.js";import{D as ae}from"./download-D6kAy5d3.js";import{U as S}from"./users-q6XJjClA.js";import{C as te}from"./chart-column-DGETuS3s.js";import{T as re}from"./trending-down-CiPk0oR1.js";import"./utils-vendor-BUCX3MvZ.js";Z.register(K,W,X,z,J,Q,Y,ee,se);async function ie(){const l=await fetch("/api/admin/analytics",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch analytics data");return l.json()}const le=["#8884d8","#82ca9d","#ffc658","#ff7300","#8dd1e1","#d88884","#84d8c7"];function ge(){const{isAdmin:l,isAuthenticated:x}=I(),[,j]=P(),[L,f]=C.useState(!1),{data:a,isLoading:U,error:E,refetch:G,isRefetching:v}=$({queryKey:["admin-analytics"],queryFn:ie,enabled:l&&x,refetchInterval:300*1e3});if(C.useEffect(()=>{(!x||!l)&&j("/")},[x,l,j]),!x||!l)return null;const B=async()=>{if(a){f(!0);try{const s={...a,exportedAt:new Date().toISOString(),exportedBy:"Admin Analytics Dashboard"},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),d=window.URL.createObjectURL(t),n=document.createElement("a");n.href=d,n.download=`analytics-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(d),document.body.removeChild(n),g({title:"Export Complete",description:"Analytics data has been exported successfully."})}catch{g({title:"Export Failed",description:"Failed to export analytics data.",variant:"destructive"})}finally{f(!1)}}},N=()=>{G(),g({title:"Refreshing Data",description:"Analytics data is being refreshed..."})},u=a?.userDistribution?.byRole?Object.entries(a.userDistribution.byRole).map(([s,t])=>({role:s.charAt(0).toUpperCase()+s.slice(1),count:t})):[],y=a?.seriesDistribution?.byStatus?Object.entries(a.seriesDistribution.byStatus).map(([s,t])=>({status:s.charAt(0).toUpperCase()+s.slice(1),count:t})):[],h=a?.genrePopularity?a.genrePopularity.slice(0,10).map(({genre:s,count:t})=>({genre:s,count:t})):[],w=s=>s>=0?e.jsx(A,{className:"w-4 h-4 text-green-600"}):e.jsx(re,{className:"w-4 h-4 text-red-600"});return U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 animate-spin text-primary"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Loading analytics data..."})]})})}):E?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-destructive mb-4",children:"Failed to load analytics data"}),e.jsxs(p,{onClick:N,variant:"outline",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Retry"]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(p,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(M,{href:"/admin",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Back to Admin"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Comprehensive insights and statistics for your MangaVerse platform"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(p,{variant:"outline",onClick:N,disabled:v,children:[e.jsx(k,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]}),e.jsxs(p,{variant:"outline",onClick:B,disabled:L,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Export Data"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.totalUsers||0}),e.jsxs("div",{className:"flex items-center mt-1",children:[w(a?.overview?.userGrowthRate||0),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:[Math.abs(a?.overview?.userGrowthRate||0).toFixed(1),"% growth"]})]})]}),e.jsx(S,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Series"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.totalSeries||0}),e.jsxs("div",{className:"flex items-center mt-1",children:[w(a?.overview?.seriesGrowthRate||0),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:[Math.abs(a?.overview?.seriesGrowthRate||0).toFixed(1),"% growth"]})]})]}),e.jsx(b,{className:"w-8 h-8 text-orange-600"})]})})}),e.jsx(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"New Users (30d)"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.newUsersLast30Days||0}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a?.overview?.newUsersLast7Days||0," in last 7 days"]})]}),e.jsx(A,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"New Series (30d)"}),e.jsx("p",{className:"text-2xl font-bold",children:a?.overview?.newSeriesLast30Days||0}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a?.overview?.newSeriesLast7Days||0," in last 7 days"]})]}),e.jsx(te,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Daily Activity (Last 30 Days)"}),e.jsx(m,{children:"User activity and page views over time"})]}),e.jsx(i,{children:e.jsx("div",{className:"h-80",children:e.jsx(H,{data:{labels:(a?.dailyActivity||[]).map(s=>new Date(s.date).toLocaleDateString()),datasets:[{label:"Active Users",data:(a?.dailyActivity||[]).map(s=>s.users),borderColor:"#8884d8",backgroundColor:"rgba(136, 132, 216, 0.1)",tension:.4},{label:"Page Views",data:(a?.dailyActivity||[]).map(s=>s.views),borderColor:"#82ca9d",backgroundColor:"rgba(130, 202, 157, 0.1)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0}}}})})})]}),e.jsxs(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(c,{children:[e.jsx(o,{children:"User Distribution by Role"}),e.jsx(m,{children:"Breakdown of users by their assigned roles"})]}),e.jsx(i,{children:e.jsx("div",{className:"h-80",children:e.jsx(V,{data:{labels:u.map(s=>s.role),datasets:[{data:u.map(s=>s.count),backgroundColor:le,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:function(s){const t=s.label||"",d=s.parsed||0,n=s.dataset.data.reduce((O,T)=>O+T,0),F=(d/n*100).toFixed(0);return`${t}: ${d} (${F}%)`}}}}}})})})]}),e.jsxs(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Series by Status"}),e.jsx(m,{children:"Distribution of series by publication status"})]}),e.jsx(i,{children:e.jsx("div",{className:"h-80",children:e.jsx(D,{data:{labels:y.map(s=>s.status),datasets:[{label:"Series Count",data:y.map(s=>s.count),backgroundColor:"#8884d8"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})})]}),e.jsxs(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Popular Genres"}),e.jsx(m,{children:"Top 10 most popular genres across all series"})]}),e.jsx(i,{children:e.jsx("div",{className:"h-80",children:h.length>0?e.jsx(D,{data:{labels:h.map(s=>s.genre),datasets:[{label:"Series Count",data:h.map(s=>s.count),backgroundColor:"#82ca9d"}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0}}}}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No genre data available"}),e.jsx("p",{className:"text-sm",children:"Add series with genres to see popularity"})]})})})})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(r,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Analytics Summary"}),e.jsx(m,{children:"Key insights from your MangaVerse platform"})]}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"User Growth"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:[Math.abs(a?.overview?.userGrowthRate||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30-day growth rate"})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Content Growth"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-2",children:[Math.abs(a?.overview?.seriesGrowthRate||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30-day growth rate"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Popular Genres"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 mt-2",children:h.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active genres"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium",children:"User Roles"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 mt-2",children:u.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Different roles"})]})]})})]})})]})})}export{ge as default};
