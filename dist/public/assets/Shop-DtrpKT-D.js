import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as _,b as G}from"./react-vendor-C7VPsBAG.js";import{u as W,Z as ee,P as se,b as f,_ as ae,d as g,N as te,$ as h,a0 as N,C as l,f as b,g as y,h as v,i as o,a1 as w,a2 as M,B as m,p as re,a3 as A,K as I,F as ie,r as x}from"./index-Bshoxa3b.js";import{T as ne,a as ce,b as P,c as S}from"./tabs-72BErqnU.js";import{P as le}from"./progress-BQnuNZzz.js";import{D as oe,a as de,b as me,c as xe,d as ue}from"./dialog-B4soTW2z.js";import{C as U}from"./crown-DnGdiNOO.js";import{T as C}from"./trophy-4C1s-oG7.js";import{Z as T}from"./zap-CuepkoNH.js";import{S as F}from"./sparkles-DRgf5F8q.js";import{S as he}from"./shopping-cart-1UVixAJg.js";import"./utils-vendor-BUCX3MvZ.js";async function E(){const p=await fetch("/api/csrf-token",{credentials:"include"});if(!p.ok)throw new Error("Failed to fetch CSRF token");return(await p.json()).csrfToken}function Te(){const[,p]=_(),{isAuthenticated:u}=W(),{data:K}=ee(),{toast:c}=se(),[t,d]=G.useState({open:!1,type:"",item:null}),{data:Q,isLoading:V}=f({queryKey:["/api/subscriptions/packages"],queryFn:async()=>{const s=await fetch("/api/subscriptions/packages",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch VIP packages");return s.json()}}),{data:k}=f({queryKey:["/api/subscriptions/my-subscription"],queryFn:async()=>{const s=await fetch("/api/subscriptions/my-subscription",{credentials:"include"});return s.ok?s.json():null},enabled:u}),{data:i,isLoading:X}=f({queryKey:["/api/battle-pass/progress"],queryFn:async()=>{const s=await fetch("/api/battle-pass/progress",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch battle pass");return s.json()},enabled:u}),{data:D,isLoading:J}=f({queryKey:["/api/flash-sales/active"],queryFn:async()=>{const s=await fetch("/api/flash-sales/active",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch flash sales");return s.json()}}),{data:L,isLoading:z}=ae(!0),$=g({mutationFn:async s=>{const r=await E(),a=await fetch("/api/subscriptions/subscribe",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r},credentials:"include",body:JSON.stringify({packageId:s})});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to subscribe")}return a.json()},onSuccess:s=>{c({title:"Success!",description:s.message||"Successfully subscribed to VIP!"}),x.invalidateQueries({queryKey:["/api/subscriptions/my-subscription"]}),x.invalidateQueries({queryKey:["/api/currency/balance"]}),d({open:!1,type:"",item:null})},onError:s=>{c({title:"Error",description:s.message,variant:"destructive"})}}),q=g({mutationFn:async()=>{const s=await E(),r=await fetch("/api/battle-pass/upgrade",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":s},credentials:"include",body:JSON.stringify({})});if(!r.ok){const a=await r.json();throw new Error(a.message||"Failed to upgrade")}return r.json()},onSuccess:s=>{c({title:"Success!",description:s.message||"Upgraded to Premium Battle Pass!"}),x.invalidateQueries({queryKey:["/api/battle-pass/progress"]}),d({open:!1,type:"",item:null})},onError:s=>{c({title:"Error",description:s.message,variant:"destructive"})}}),B=g({mutationFn:async s=>{const r=await E(),a=await fetch("/api/flash-sales/purchase",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r},credentials:"include",body:JSON.stringify({saleId:s})});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to purchase")}return a.json()},onSuccess:s=>{c({title:"Success!",description:`${s.message} - Received ${s.coinsReceived} coins!`}),x.invalidateQueries({queryKey:["/api/currency/balance"]}),x.invalidateQueries({queryKey:["/api/flash-sales/active"]}),d({open:!1,type:"",item:null})},onError:s=>{c({title:"Error",description:s.message,variant:"destructive"})}}),O=g({mutationFn:async s=>{const r=await E(),a=await fetch("/api/currency/purchase",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r},credentials:"include",body:JSON.stringify({packageId:s})});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to purchase")}return a.json()},onSuccess:s=>{c({title:"Purchase Successful!",description:`You received ${s.coinsReceived} coins!`}),x.invalidateQueries({queryKey:["/api/currency/balance"]}),d({open:!1,type:"",item:null})},onError:s=>{c({title:"Purchase Failed",description:s.message,variant:"destructive"})}}),j=(s,r)=>{if(!u){p("/login?returnTo=/shop");return}d({open:!0,type:s,item:r})},Z=()=>{t.type==="vip"?$.mutate(t.item.id):t.type==="battlepass"?q.mutate():t.type==="flashsale"?B.mutate(t.item.id):t.type==="coins"&&O.mutate(t.item.id)},H=s=>{const r=new Date(s).getTime(),a=Date.now(),n=r-a;if(n<=0)return"Expired";const R=Math.floor(n/(1e3*60*60)),Y=Math.floor(n%(1e3*60*60)/(1e3*60));return`${R}h ${Y}m`};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-background via-background to-primary/5",children:[e.jsx(te,{}),e.jsxs("main",{className:"flex-1 container mx-auto px-4 py-8 mt-16",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent mb-4",children:"Premium Shop"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Enhance your reading experience with exclusive memberships, battle passes, and limited-time offers"}),u&&K&&e.jsxs("div",{className:"mt-6 inline-flex items-center gap-2 px-6 py-3 bg-card/80 backdrop-blur-md border border-primary/20 rounded-full",children:[e.jsx(h,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{className:"font-bold text-lg",children:[K.balance," Coins"]})]})]}),e.jsxs(ne,{defaultValue:"coins",className:"w-full",children:[e.jsxs(ce,{className:"grid w-full max-w-5xl mx-auto grid-cols-4 mb-8",children:[e.jsxs(P,{value:"coins",className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Coin Packages"}),e.jsx("span",{className:"sm:hidden",children:"Coins"})]}),e.jsxs(P,{value:"vip",className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"VIP Memberships"}),e.jsx("span",{className:"sm:hidden",children:"VIP"})]}),e.jsxs(P,{value:"battlepass",className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Battle Pass"}),e.jsx("span",{className:"sm:hidden",children:"Pass"})]}),e.jsxs(P,{value:"flashsales",className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Flash Sales"}),e.jsx("span",{className:"sm:hidden",children:"Sales"})]})]}),e.jsx(S,{value:"coins",className:"space-y-6",children:z?e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx(N,{className:"h-80"},s))}):L&&L.length>0?e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:L.map(s=>{const r=s.currencyAmount+Math.floor(s.currencyAmount*s.bonusPercentage/100),a=Math.floor(s.currencyAmount*s.bonusPercentage/100);return e.jsxs(l,{className:"relative overflow-hidden transition-all duration-300 hover:shadow-xl hover:scale-105 border-primary/20",children:[s.bonusPercentage>0&&e.jsxs("div",{className:"absolute top-0 right-0 bg-accent text-accent-foreground px-3 py-1 text-xs font-bold",children:["+",s.bonusPercentage,"% BONUS"]}),e.jsxs(b,{className:"text-center pb-4",children:[e.jsxs("div",{className:"mx-auto mb-4 relative",children:[e.jsx(h,{className:"w-16 h-16 text-primary"}),a>0&&e.jsx(F,{className:"w-6 h-6 text-accent absolute -top-1 -right-1"})]}),e.jsx(y,{className:"text-2xl",children:s.name}),e.jsxs(v,{className:"mt-2",children:[s.currencyAmount.toLocaleString()," coins",a>0&&e.jsxs("span",{className:"text-accent font-semibold",children:[" + ",a.toLocaleString()," bonus"]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("span",{className:"text-4xl font-bold text-primary",children:["$",s.priceUSD]})})]}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Coins"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:r.toLocaleString()})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(w,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:"Instant delivery"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(w,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:"Use on any content"})]}),a>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"font-semibold text-accent",children:"Limited time bonus!"})]})]})]}),e.jsx(M,{children:e.jsxs(m,{onClick:()=>j("coins",s),className:"w-full",size:"lg",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Buy Now"]})})]},s.id)})}):e.jsx(l,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(h,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No coin packages available at the moment"})]})})}),e.jsx(S,{value:"vip",className:"space-y-6",children:V?e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx(N,{className:"h-96"},s))}):e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:Q?.filter(s=>s.isActive==="true").map(s=>{const r=s.features?JSON.parse(s.features):[],a=k&&k.packageId===s.id&&k.status==="active";return e.jsxs(l,{className:`relative overflow-hidden transition-all duration-300 hover:shadow-xl hover:scale-105 ${s.name.includes("Elite")?"border-2 border-primary":""}`,children:[s.name.includes("Elite")&&e.jsx("div",{className:"absolute top-0 right-0 bg-primary text-primary-foreground px-3 py-1 text-xs font-bold",children:"BEST VALUE"}),e.jsxs(b,{className:"text-center pb-4",children:[e.jsx(U,{className:`w-12 h-12 mx-auto mb-4 ${s.name.includes("Elite")?"text-primary":s.name.includes("Premium")?"text-accent":"text-muted-foreground"}`}),e.jsx(y,{className:"text-2xl",children:s.name}),e.jsx(v,{children:s.description}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-4xl font-bold text-primary",children:["$",s.priceUSD]}),e.jsx("span",{className:"text-muted-foreground",children:"/month"})]})]}),e.jsxs(o,{className:"space-y-3",children:[r.map((n,R)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:n})]},R)),s.coinBonus>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("span",{className:"text-sm font-semibold",children:[s.coinBonus," bonus coins/month"]})]})]}),e.jsx(M,{children:e.jsx(m,{onClick:()=>j("vip",s),disabled:a,className:"w-full",variant:s.name.includes("Elite")?"default":"outline",children:a?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Current Plan"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Subscribe"]})})})]},s.id)})})}),e.jsx(S,{value:"battlepass",className:"space-y-6",children:X?e.jsx(N,{className:"h-96"}):i?.progress&&i?.season?e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{className:"bg-gradient-to-r from-card/80 to-primary/5 backdrop-blur-md border-primary/20",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(y,{className:"text-3xl flex items-center gap-3",children:[e.jsx(C,{className:"w-8 h-8 text-primary"}),i.season.name]}),e.jsx(v,{className:"mt-2",children:i.season.description})]}),e.jsx(re,{variant:i.progress.isPremium==="true"?"default":"outline",className:"text-lg px-4 py-2",children:i.progress.isPremium==="true"?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),"Premium"]}):"Free"})]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Current Tier: ",i.progress.currentTier]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i.progress.experience," / ",i.progress.nextTierExperience," XP"]})]}),e.jsx(le,{value:i.progress.experience/i.progress.nextTierExperience*100,className:"h-3"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Season Ends"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(i.season.endDate).toLocaleDateString()})]}),e.jsx(I,{className:"w-6 h-6 text-muted-foreground"})]}),i.progress.isPremium!=="true"&&e.jsx(l,{className:"border-primary/50 bg-gradient-to-r from-primary/10 to-accent/10",children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Upgrade to Premium"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Unlock exclusive rewards, bonus XP, and premium tier items"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(F,{className:"w-4 h-4 text-primary"}),"2x Coin Rewards"]}),e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"w-4 h-4 text-primary"}),"Exclusive Premium Tiers"]}),e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"w-4 h-4 text-primary"}),"Special Badges & Icons"]})]})]}),e.jsxs(m,{onClick:()=>j("battlepass",null),className:"flex-shrink-0",size:"lg",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Upgrade - $9.99"]})]})})})]})]})}):e.jsx(l,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No active battle pass season"})]})})}),e.jsx(S,{value:"flashsales",className:"space-y-6",children:J?e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:[1,2].map(s=>e.jsx(N,{className:"h-64"},s))}):D&&D.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:D.map(s=>{const r=H(s.endTime),a=s.maxPurchases&&s.currentPurchases>=s.maxPurchases;return e.jsxs(l,{className:"relative overflow-hidden border-2 border-accent/50 hover:border-accent transition-colors",children:[e.jsxs("div",{className:"absolute top-0 right-0 bg-accent text-accent-foreground px-4 py-1 text-sm font-bold flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),s.discountPercentage,"% OFF"]}),e.jsxs(b,{children:[e.jsx(y,{className:"text-2xl pr-24",children:s.name}),e.jsx(v,{children:s.description})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground line-through",children:["$",s.originalPrice]}),e.jsxs("p",{className:"text-3xl font-bold text-accent",children:["$",s.salePrice]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(I,{className:"w-4 h-4"}),r]}),s.maxPurchases&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.currentPurchases||0," / ",s.maxPurchases," sold"]})]})]}),e.jsx(m,{onClick:()=>j("flashsale",s),disabled:a||r==="Expired",className:"w-full",size:"lg",children:a?"Sold Out":r==="Expired"?"Expired":e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Buy Now"]})})]})]},s.id)})}):e.jsx(l,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(T,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"No active flash sales at the moment"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Check back soon for limited-time offers!"})]})})})]})]}),e.jsx(ie,{}),e.jsx(oe,{open:t.open,onOpenChange:s=>d({...t,open:s}),children:e.jsxs(de,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Confirm Purchase"}),e.jsxs(ue,{children:[t.type==="vip"&&t.item&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:["Subscribe to ",e.jsx("strong",{children:t.item.name})," for ",e.jsxs("strong",{children:["$",t.item.priceUSD,"/month"]}),"?"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a simulated purchase. No real payment will be processed."})]}),t.type==="battlepass"&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:["Upgrade to ",e.jsx("strong",{children:"Premium Battle Pass"})," for ",e.jsx("strong",{children:"$9.99"}),"?"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a simulated purchase. No real payment will be processed."})]}),t.type==="flashsale"&&t.item&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:["Purchase ",e.jsx("strong",{children:t.item.name})," for ",e.jsxs("strong",{children:["$",t.item.salePrice]}),"?"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a simulated purchase. No real payment will be processed."})]}),t.type==="coins"&&t.item&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:["Purchase ",e.jsx("strong",{children:t.item.name})," for ",e.jsxs("strong",{children:["$",t.item.priceUSD]}),"?"]}),e.jsxs("div",{className:"p-3 bg-primary/10 rounded-lg mt-3",children:[e.jsx("p",{className:"text-sm",children:"You will receive:"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[(t.item.currencyAmount+Math.floor(t.item.currencyAmount*t.item.bonusPercentage/100)).toLocaleString()," coins"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a simulated purchase. No real payment will be processed."})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>d({open:!1,type:"",item:null}),className:"flex-1",children:"Cancel"}),e.jsx(m,{onClick:Z,disabled:$.isPending||q.isPending||B.isPending||O.isPending,className:"flex-1",children:$.isPending||q.isPending||B.isPending||O.isPending?"Processing...":"Confirm Purchase"})]})]})})]})}export{Te as default};
