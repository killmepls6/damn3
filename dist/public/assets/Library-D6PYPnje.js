import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as E,b}from"./react-vendor-C7VPsBAG.js";import{b as U,u as z,s as P,e as j,N as B,v as N,B as n,F as L,D as $,w as q,x as G,y as J,E as v,G as K,H as O,J as H,C as y,i as w,p as D,K as M}from"./index-Bshoxa3b.js";import{i as S}from"./utils-vendor-BUCX3MvZ.js";function Q(l=!1){const{data:p,isLoading:a,error:c,isError:d}=U({queryKey:["/api/library"],queryFn:async()=>{const t=await fetch("/api/library",{credentials:"include"});if(t.status===401)return[];if(!t.ok)throw new Error("Failed to fetch library");return t.json()},enabled:l,retry:!1});return{library:p||[],isLoading:a,error:c,isError:d}}function X(){const{isAuthenticated:l,isLoading:p}=z(),{library:a,isLoading:c}=Q(l),{progressList:d}=P(l),[,t]=E(),[m,k]=b.useState("grid"),[o,f]=b.useState("recent");if(p)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"w-12 h-12 text-primary mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})});if(!l)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-20 text-center",children:[e.jsx(N,{className:"w-20 h-20 text-primary/50 mx-auto mb-6"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Sign in to view your library"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Create an account or sign in to save your favorite manga and track your reading progress."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(n,{onClick:()=>t("/login"),className:"bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90",children:"Sign In"}),e.jsx(n,{onClick:()=>t("/signup"),variant:"outline",children:"Create Account"})]})]}),e.jsx(L,{})]});const R=b.useMemo(()=>{const r=new Map(d.map(s=>[s.seriesId,{chapterNumber:s.chapterNumber,lastReadAt:s.lastReadAt}]));return[...a].sort((s,i)=>{if(o==="recent")return new Date(i.addedAt).getTime()-new Date(s.addedAt).getTime();if(o==="title")return s.series.title.localeCompare(i.series.title);if(o==="progress"){const x=r.get(s.seriesId),u=r.get(i.seriesId),I=x?.chapterNumber?parseFloat(x.chapterNumber):0,T=u?.chapterNumber?parseFloat(u.chapterNumber):0,A=s.series.totalChapters||0,C=i.series.totalChapters||0,g=A>0?I/A*100:0,h=C>0?T/C*100:0;if(g===0&&h===0)return 0;if(g===0)return 1;if(h===0)return-1;if(g!==h)return h-g;const F=x?.lastReadAt?new Date(x.lastReadAt).getTime():0;return(u?.lastReadAt?new Date(u.lastReadAt).getTime():0)-F}return 0})},[a,d,o]);return e.jsxs("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:[e.jsx(B,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-accent rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"My Library"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[a.length," ",(a.length===1,"series")," saved"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",className:"hidden sm:flex",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Sort: ",o==="recent"?"Recent":o==="title"?"Title":"Progress"]})}),e.jsxs(J,{align:"end",children:[e.jsx(v,{onClick:()=>f("recent"),children:"Most Recent"}),e.jsx(v,{onClick:()=>f("title"),children:"Title (A-Z)"}),e.jsx(v,{onClick:()=>f("progress"),children:"Reading Progress"})]})]}),e.jsxs("div",{className:"hidden sm:flex border border-border rounded-lg p-1",children:[e.jsx(n,{variant:m==="grid"?"default":"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>k("grid"),children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx(n,{variant:m==="list"?"default":"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>k("list"),children:e.jsx(O,{className:"w-4 h-4"})})]})]})]}),c&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6",children:[...Array(10)].map((r,s)=>e.jsx(H,{},s))}),!c&&a.length===0&&e.jsx(y,{className:"bg-card/80 backdrop-blur-md border-border/50",children:e.jsxs(w,{className:"py-16 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"Your library is empty"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Start adding manga to your library to keep track of your favorites!"}),e.jsx(n,{onClick:()=>t("/browse"),className:"bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90",children:"Browse Manga"})]})}),!c&&a.length>0&&e.jsx("div",{className:m==="grid"?"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6":"space-y-4",children:R.map(r=>m==="grid"?e.jsxs(y,{className:"group bg-card/80 backdrop-blur-md border-border/50 hover:border-primary/60 transition-all duration-300 overflow-hidden cursor-pointer hover:shadow-lg hover:shadow-primary/20",onClick:()=>t(`/manga/${r.series.id}`),children:[e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden",children:[r.series.coverImageUrl?e.jsx("img",{src:r.series.coverImageUrl,alt:r.series.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-muted/80 to-muted/60 flex items-center justify-center",children:e.jsx(j,{className:"w-12 h-12 text-muted-foreground/50"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),r.series.status&&e.jsx(D,{className:"absolute top-2 right-2 bg-primary/90 backdrop-blur-sm",children:r.series.status})]}),e.jsxs(w,{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 text-foreground group-hover:text-primary transition-colors mb-2",children:r.series.title}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Added ",S(new Date(r.addedAt),{addSuffix:!0})]})]})]},r.id):e.jsx(y,{className:"group bg-card/80 backdrop-blur-md border-border/50 hover:border-primary/60 transition-all duration-300 cursor-pointer hover:shadow-lg hover:shadow-primary/20",onClick:()=>t(`/manga/${r.series.id}`),children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"relative w-24 h-32 flex-shrink-0 overflow-hidden rounded-lg",children:r.series.coverImageUrl?e.jsx("img",{src:r.series.coverImageUrl,alt:r.series.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-muted/80 to-muted/60 flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-muted-foreground/50"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground group-hover:text-primary transition-colors mb-2",children:r.series.title}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(()=>{const s=typeof r.series.genres=="string"?JSON.parse(r.series.genres):r.series.genres;return Array.isArray(s)&&s.slice(0,3).map(i=>e.jsx(D,{variant:"outline",className:"text-xs",children:i},i))})()}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Added ",S(new Date(r.addedAt),{addSuffix:!0})]})]})]})})},r.id))})]}),e.jsx(L,{})]})}export{X as default};
