import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as W,b as p,L as Y}from"./react-vendor-C7VPsBAG.js";import{c as A,u as $,z as G,a as Z,b as M,d as L,L as v,B as d,e as _,C as x,f as g,g as j,U as ee,h as w,i as f,A as se,j as ae,k as re,l as te,S as ie,m as c,I as h,M as ne,n as le,o as oe,p as ce,q as de,t as n,r as b}from"./index-Bshoxa3b.js";import{S as ue,a as me,b as he,c as pe,d as l}from"./select-DT_5i3rD.js";import{D as xe,a as ge,b as je,c as fe,d as ye,e as Ne}from"./dialog-B4soTW2z.js";import{M as ve}from"./map-pin-DjCNlwfX.js";import{T as U}from"./trophy-4C1s-oG7.js";import{M as E}from"./monitor-CG5dKqcR.js";import"./utils-vendor-BUCX3MvZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=A("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=A("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);function Ue(){const{isAuthenticated:u,isLoading:P}=$(),[,D]=W(),{theme:T,setTheme:O}=G(),{logout:I,isLoggingOut:q}=Z(),[r,t]=p.useState({username:"",email:"",firstName:"",lastName:"",country:"",profilePicture:null}),[R,y]=p.useState(!1),[m,N]=p.useState({oldPassword:"",newPassword:""}),{data:k,isLoading:K}=M({queryKey:["/api/achievements"],queryFn:async()=>{const s=await fetch("/api/achievements",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch achievements");return s.json()},enabled:u}),{data:z,isLoading:B}=M({queryKey:["/api/achievements/my-progress"],queryFn:async()=>{const s=await fetch("/api/achievements/my-progress",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch user achievements");return s.json()},enabled:u});p.useEffect(()=>{!P&&!u&&D("/login?returnTo=/settings")},[P,u,D]);const{data:o,isLoading:Q}=M({queryKey:["/api/user/profile"],queryFn:async()=>{const s=await fetch("/api/user/profile",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch profile");return(await s.json()).user},enabled:u,retry:!1});p.useEffect(()=>{o&&t({username:o.username||"",email:o.email||"",firstName:o.firstName||"",lastName:o.lastName||"",country:o.country||"",profilePicture:o.profilePicture||null})},[o]);const C=L({mutationFn:async s=>{const a=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify(s)});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to update profile")}return a.json()},onSuccess:s=>{b.invalidateQueries({queryKey:["/api/user/profile"]}),b.invalidateQueries({queryKey:["/api/auth/user"]}),n({title:"Profile Updated",description:"Your profile has been updated successfully."}),s.user&&t(a=>({...a,username:s.user.username||a.username,email:s.user.email||a.email,firstName:s.user.firstName||a.firstName,lastName:s.user.lastName||a.lastName,country:s.user.country||a.country}))},onError:s=>{n({title:"Update Failed",description:s.message,variant:"destructive"})}}),F=L({mutationFn:async s=>{const a=new FormData;a.append("profilePicture",s);const i=await fetch("/api/user/profile-picture",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:a});if(!i.ok){const V=await i.json();throw new Error(V.message||"Failed to upload profile picture")}return i.json()},onSuccess:s=>{b.invalidateQueries({queryKey:["/api/user/profile"]}),b.invalidateQueries({queryKey:["/api/auth/user"]}),t(a=>({...a,profilePicture:s.profilePicture})),n({title:"Profile Picture Updated",description:"Your profile picture has been uploaded successfully."})},onError:s=>{n({title:"Upload Failed",description:s.message,variant:"destructive"})}}),S=L({mutationFn:async s=>{const a=await fetch("/api/user/password",{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify(s)});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to change password")}return a.json()},onSuccess:()=>{n({title:"Password Changed",description:"Your password has been updated successfully."}),N({oldPassword:"",newPassword:""}),y(!1)},onError:s=>{n({title:"Password Change Failed",description:s.message,variant:"destructive"})}}),X=s=>{const a=s.target.files?.[0];if(a){if(a.size>5*1024*1024){n({title:"File Too Large",description:"Profile picture must be less than 5MB.",variant:"destructive"});return}F.mutate(a)}},H=()=>{C.mutate({username:r.username,email:r.email,firstName:r.firstName,lastName:r.lastName,country:r.country})},J=()=>{if(!m.oldPassword||!m.newPassword){n({title:"Missing Fields",description:"Please fill in both password fields.",variant:"destructive"});return}if(m.newPassword.length<8){n({title:"Invalid Password",description:"New password must be at least 8 characters long.",variant:"destructive"});return}S.mutate(m)};return P||Q?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-4 flex items-center justify-center",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):u?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-background/95 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{href:"/",children:e.jsx(d,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-primary",children:"â† Back to MangaVerse"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-accent to-purple-400 bg-clip-text text-transparent",children:"Settings"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile Information"})]}),e.jsx(w,{children:"Manage your profile details and preferences"})]}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(se,{className:"w-20 h-20",children:[e.jsx(ae,{src:r.profilePicture||void 0}),e.jsx(re,{className:"text-2xl bg-primary/10 text-primary",children:r.username?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("label",{htmlFor:"profile-upload",className:"absolute -bottom-2 -right-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-full p-2 cursor-pointer shadow-lg transition-colors",children:[F.isPending?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(te,{className:"w-4 h-4"}),e.jsx("input",{id:"profile-upload",type:"file",accept:"image/*",autoComplete:"off",onChange:X,className:"hidden",disabled:F.isPending})]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a profile picture. Max size: 5MB. Recommended: 400x400px"})})]}),e.jsx(ie,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"username",children:"Username"}),e.jsx(h,{id:"username",value:r.username,onChange:s=>t(a=>({...a,username:s.target.value})),className:"bg-background/50",autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{id:"email",type:"email",value:r.email,onChange:s=>t(a=>({...a,email:s.target.value})),className:"bg-background/50 pl-10",autoComplete:"email"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"firstName",children:"First Name (Optional)"}),e.jsx(h,{id:"firstName",value:r.firstName,onChange:s=>t(a=>({...a,firstName:s.target.value})),className:"bg-background/50",placeholder:"John",autoComplete:"given-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"lastName",children:"Last Name (Optional)"}),e.jsx(h,{id:"lastName",value:r.lastName,onChange:s=>t(a=>({...a,lastName:s.target.value})),className:"bg-background/50",placeholder:"Doe",autoComplete:"family-name"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(c,{htmlFor:"country",children:"Country (Optional)"}),e.jsx("input",{type:"text",name:"country",autoComplete:"country-name",value:r.country||"",tabIndex:-1,"aria-hidden":"true",className:"absolute -left-[9999px] w-1 h-1 opacity-0",onChange:s=>{t({...r,country:s.target.value})}}),e.jsxs(ue,{value:r.country,onValueChange:s=>t(a=>({...a,country:s})),children:[e.jsx(me,{className:"bg-background/50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Select your country"})]})}),e.jsxs(pe,{children:[e.jsx(l,{value:"us",children:"United States"}),e.jsx(l,{value:"ca",children:"Canada"}),e.jsx(l,{value:"uk",children:"United Kingdom"}),e.jsx(l,{value:"jp",children:"Japan"}),e.jsx(l,{value:"kr",children:"South Korea"}),e.jsx(l,{value:"fr",children:"France"}),e.jsx(l,{value:"de",children:"Germany"}),e.jsx(l,{value:"au",children:"Australia"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(d,{className:"bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white",onClick:H,disabled:C.isPending,children:C.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Profile"})})]})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsx(j,{children:"Account Security"}),e.jsx(w,{children:"Manage your password and account security"})]}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Change Password"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your password for security"})]}),e.jsxs(d,{variant:"outline",onClick:()=>y(!0),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Update Password"]})]})})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Achievements"})]}),e.jsx(w,{children:"Track your reading milestones and accomplishments"})]}),e.jsx(f,{children:K||B?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"h-20 bg-background/50 animate-pulse rounded-lg"},s))}):k&&k.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:k.map(s=>{const a=z?.some(i=>i.achievementId===s.id);return e.jsx("div",{className:`p-3 rounded-lg border transition-all ${a?"bg-primary/10 border-primary/50 hover:bg-primary/20":"bg-background/30 border-border/30 opacity-50 grayscale"}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[s.badgeIcon?e.jsx("span",{className:"text-2xl",children:s.badgeIcon}):e.jsx(oe,{className:`w-8 h-8 ${a?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold ${a?"text-foreground":"text-muted-foreground"}`,children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description}),a&&s.coinReward>0&&e.jsxs(ce,{variant:"secondary",className:"mt-1 text-xs",children:["+",s.coinReward," coins"]})]})]})},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No achievements available yet"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"Appearance"})]}),e.jsx(w,{children:"Customize how MangaVerse looks and feels"})]}),e.jsx(f,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{children:"Theme Preference"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:[{value:"light",label:"Light",icon:be},{value:"dark",label:"Dark",icon:we},{value:"system",label:"System",icon:E}].map(s=>{const a=s.icon;return e.jsxs(d,{variant:T===s.value?"default":"outline",className:"justify-start",onClick:()=>O(s.value),children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),s.label]},s.value)})})]})})]}),e.jsxs(x,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsx(g,{children:e.jsx(j,{children:"Quick Actions"})}),e.jsx(f,{className:"space-y-2",children:e.jsxs(d,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive",onClick:()=>I(),disabled:q,"data-testid":"settings-logout-button",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),q?"Signing out...":"Sign Out"]})})]})]})]})]}),e.jsx(xe,{open:R,onOpenChange:y,children:e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsxs(je,{children:[e.jsx(fe,{children:"Change Password"}),e.jsx(ye,{children:"Enter your current password and a new password to update your account security."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"current-password",children:"Current Password"}),e.jsx(h,{id:"current-password",type:"password",value:m.oldPassword,onChange:s=>N(a=>({...a,oldPassword:s.target.value})),placeholder:"Enter current password",autoComplete:"current-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"new-password",children:"New Password"}),e.jsx(h,{id:"new-password",type:"password",value:m.newPassword,onChange:s=>N(a=>({...a,newPassword:s.target.value})),placeholder:"Enter new password (min 8 characters)",autoComplete:"new-password"})]})]}),e.jsxs(Ne,{children:[e.jsx(d,{variant:"outline",onClick:()=>{y(!1),N({oldPassword:"",newPassword:""})},children:"Cancel"}),e.jsx(d,{onClick:J,disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Changing..."]}):"Change Password"})]})]})})]}):null}export{Ue as default};
