import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as V,b as u}from"./react-vendor-C7VPsBAG.js";import{c as W,u as Z,P as J,ah as Y,b as k,d as w,a0 as F,B as d,a8 as _,C as E,i as G,p as S,K as ee,T as ae,m as c,I as l,Y as I}from"./index-Bshoxa3b.js";import{D as q,a as L,b as M,c as O,d as U,e as A}from"./dialog-B4soTW2z.js";import{S as se,a as te,b as re,c as ie,d as ne}from"./select-DT_5i3rD.js";import{P as $}from"./plus-CIXQeA2Y.js";import{Z as ce}from"./zap-CuepkoNH.js";import{P as le}from"./percent-I0-8Qg6_.js";import{S as de}from"./square-pen-C7u-hRzu.js";import"./utils-vendor-BUCX3MvZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=W("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);function ve(){const{isAdmin:p,isAuthenticated:j}=Z(),[,P]=V(),{toast:o}=J(),y=Y(),[R,m]=u.useState(!1),[B,g]=u.useState(!1),[C,T]=u.useState(null),[s,r]=u.useState({name:"",description:"",targetId:"",discountPercentage:"20",startTime:"",endTime:"",maxPurchases:""}),{data:f,isLoading:H}=k({queryKey:["/api/admin/flash-sales"],queryFn:async()=>{const a=await fetch("/api/admin/flash-sales",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch flash sales");return a.json()},enabled:p&&j}),{data:x}=k({queryKey:["/api/currency/packages"],queryFn:async()=>{const a=await fetch("/api/currency/packages",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch packages");return a.json()},enabled:p&&j});async function b(){const a=await fetch("/api/csrf-token",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch CSRF token");return(await a.json()).csrfToken}const v=w({mutationFn:async a=>{const i=await b(),t=await fetch("/api/admin/flash-sales/create",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-csrf-token":i},credentials:"include",body:JSON.stringify(a)});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to create flash sale")}return t.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale created successfully"}),m(!1),D()},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),N=w({mutationFn:async({id:a,data:i})=>{const t=await b(),n=await fetch(`/api/admin/flash-sales/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-csrf-token":t},credentials:"include",body:JSON.stringify(i)});if(!n.ok){const h=await n.json();throw new Error(h.message||"Failed to update flash sale")}return n.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale updated successfully"}),g(!1),T(null)},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),K=w({mutationFn:async a=>{const i=await b(),t=await fetch(`/api/admin/flash-sales/${a}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","x-csrf-token":i},credentials:"include"});if(!t.ok)throw new Error("Failed to delete flash sale");return t.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/flash-sales"]}),o({title:"Success",description:"Flash sale deleted successfully"})},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),D=()=>{r({name:"",description:"",targetId:"",discountPercentage:"20",startTime:"",endTime:"",maxPurchases:""})},X=()=>{if(!s.targetId||!s.startTime||!s.endTime){o({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}const a=x?.find(h=>h.id===s.targetId);if(!a)return;const i=parseFloat(a.priceUSD),t=parseFloat(s.discountPercentage)/100,n=(i*(1-t)).toFixed(2);v.mutate({name:s.name||`${a.name} Flash Sale`,description:s.description||null,type:"coin_package",targetId:s.targetId,discountPercentage:parseInt(s.discountPercentage),originalPrice:a.priceUSD,salePrice:n,startTime:new Date(s.startTime).toISOString(),endTime:new Date(s.endTime).toISOString(),maxPurchases:s.maxPurchases?parseInt(s.maxPurchases):null})},Q=a=>{T(a),r({name:a.name,description:a.description||"",targetId:a.targetId||"",discountPercentage:a.discountPercentage.toString(),startTime:new Date(a.startTime).toISOString().slice(0,16),endTime:new Date(a.endTime).toISOString().slice(0,16),maxPurchases:a.maxPurchases?.toString()||""}),g(!0)},z=()=>{if(!C)return;const a=x?.find(h=>h.id===s.targetId);if(!a)return;const i=parseFloat(a.priceUSD),t=parseFloat(s.discountPercentage)/100,n=(i*(1-t)).toFixed(2);N.mutate({id:C.id,data:{name:s.name,description:s.description||null,discountPercentage:parseInt(s.discountPercentage),salePrice:n,startTime:new Date(s.startTime).toISOString(),endTime:new Date(s.endTime).toISOString(),maxPurchases:s.maxPurchases?parseInt(s.maxPurchases):null}})};return!j||!p?(P("/"),null):H?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-black to-gray-900 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(F,{className:"h-12 w-96 mb-8 bg-gray-800"}),e.jsx("div",{className:"grid gap-6",children:[1,2,3].map(a=>e.jsx(F,{className:"h-32 bg-gray-800"},a))})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-black to-gray-900 p-4 md:p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(d,{variant:"ghost",onClick:()=>P("/admin/monetization"),className:"text-gray-400 hover:text-white mb-4",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Back to Monetization"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"Flash Sales Management"}),e.jsx("p",{className:"text-gray-400",children:"Create and manage limited-time offers"})]}),e.jsxs(d,{onClick:()=>{D(),m(!0)},className:"bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Create Flash Sale"]})]})]}),e.jsx("div",{className:"grid gap-6",children:!f||f.length===0?e.jsxs(E,{className:"bg-gray-900/50 border-gray-800 text-center p-16",children:[e.jsx(ce,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"No Flash Sales"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Create your first flash sale to boost revenue"}),e.jsxs(d,{onClick:()=>m(!0),className:"bg-primary",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Create Flash Sale"]})]}):f.map(a=>{const i=a.isActive==="true",t=new Date(a.startTime)<=new Date,n=new Date(a.endTime)<=new Date;return a.maxPurchases&&(a.maxPurchases-a.currentPurchases)/a.maxPurchases*100,e.jsx(E,{className:`bg-gray-900/50 border-gray-800 ${i&&t&&!n?"border-red-500/30":""}`,children:e.jsx(G,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:a.name}),i&&t&&!n&&e.jsx(S,{className:"bg-red-500/20 text-red-500 border-red-500/30 animate-pulse",children:"LIVE"}),n&&e.jsx(S,{className:"bg-gray-500/20 text-gray-500 border-gray-500/30",children:"ENDED"}),!t&&e.jsx(S,{className:"bg-blue-500/20 text-blue-500 border-blue-500/30",children:"SCHEDULED"})]}),a.description&&e.jsx("p",{className:"text-gray-400 mb-4",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Discount"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4 text-red-500"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[a.discountPercentage,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Price"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-500 line-through",children:["$",a.originalPrice]}),e.jsxs("span",{className:"text-lg font-bold text-green-500",children:["$",a.salePrice]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Period"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-primary"}),e.jsxs("p",{className:"text-sm text-white",children:[new Date(a.startTime).toLocaleDateString()," -"," ",new Date(a.endTime).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Stock"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4 text-amber-500"}),e.jsx("p",{className:"text-sm text-white",children:a.maxPurchases?`${a.maxPurchases-a.currentPurchases}/${a.maxPurchases}`:"Unlimited"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Q(a),className:"border-gray-700 text-gray-300",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{confirm("Are you sure you want to delete this flash sale?")&&K.mutate(a.id)},className:"border-gray-700 text-red-500 hover:bg-red-500/10",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})})},a.id)})})]}),e.jsx(q,{open:R,onOpenChange:m,children:e.jsxs(L,{className:"bg-gray-900 border-gray-800 text-white max-w-2xl",children:[e.jsxs(M,{children:[e.jsx(O,{children:"Create Flash Sale"}),e.jsx(U,{className:"text-gray-400",children:"Set up a limited-time offer for a currency package"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Sale Name (optional)"}),e.jsx(l,{value:s.name,onChange:a=>r({...s,name:a.target.value}),placeholder:"e.g., Weekend Special",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Description (optional)"}),e.jsx(I,{value:s.description,onChange:a=>r({...s,description:a.target.value}),placeholder:"Brief description of the sale",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Select Package *"}),e.jsxs(se,{value:s.targetId,onValueChange:a=>r({...s,targetId:a}),children:[e.jsx(te,{className:"bg-gray-800 border-gray-700 text-white",children:e.jsx(re,{placeholder:"Choose a currency package"})}),e.jsx(ie,{className:"bg-gray-800 border-gray-700",children:x?.map(a=>e.jsxs(ne,{value:a.id,className:"text-white",children:[a.name," - ",a.currencyAmount," coins ($",a.priceUSD,")"]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Discount Percentage *"}),e.jsx(l,{type:"number",value:s.discountPercentage,onChange:a=>r({...s,discountPercentage:a.target.value}),placeholder:"20",min:"1",max:"90",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Start Time *"}),e.jsx(l,{type:"datetime-local",value:s.startTime,onChange:a=>r({...s,startTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"End Time *"}),e.jsx(l,{type:"datetime-local",value:s.endTime,onChange:a=>r({...s,endTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Max Purchases (optional)"}),e.jsx(l,{type:"number",value:s.maxPurchases,onChange:a=>r({...s,maxPurchases:a.target.value}),placeholder:"Leave empty for unlimited",min:"1",className:"bg-gray-800 border-gray-700 text-white"})]}),s.targetId&&s.discountPercentage&&e.jsx("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-gray-300",children:["Sale Price: $",(parseFloat(x?.find(a=>a.id===s.targetId)?.priceUSD||"0")*(1-parseFloat(s.discountPercentage)/100)).toFixed(2)]})})]}),e.jsxs(A,{children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),className:"border-gray-700",children:"Cancel"}),e.jsx(d,{onClick:X,disabled:v.isPending,className:"bg-gradient-to-r from-red-500 to-orange-500",children:v.isPending?"Creating...":"Create Flash Sale"})]})]})}),e.jsx(q,{open:B,onOpenChange:g,children:e.jsxs(L,{className:"bg-gray-900 border-gray-800 text-white max-w-2xl",children:[e.jsxs(M,{children:[e.jsx(O,{children:"Edit Flash Sale"}),e.jsx(U,{className:"text-gray-400",children:"Update flash sale details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Sale Name"}),e.jsx(l,{value:s.name,onChange:a=>r({...s,name:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Description"}),e.jsx(I,{value:s.description,onChange:a=>r({...s,description:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Discount Percentage"}),e.jsx(l,{type:"number",value:s.discountPercentage,onChange:a=>r({...s,discountPercentage:a.target.value}),min:"1",max:"90",className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Start Time"}),e.jsx(l,{type:"datetime-local",value:s.startTime,onChange:a=>r({...s,startTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"End Time"}),e.jsx(l,{type:"datetime-local",value:s.endTime,onChange:a=>r({...s,endTime:a.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Max Purchases"}),e.jsx(l,{type:"number",value:s.maxPurchases,onChange:a=>r({...s,maxPurchases:a.target.value}),placeholder:"Leave empty for unlimited",min:"1",className:"bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs(A,{children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),className:"border-gray-700",children:"Cancel"}),e.jsx(d,{onClick:z,disabled:N.isPending,className:"bg-primary",children:N.isPending?"Updating...":"Update Flash Sale"})]})]})})]})}export{ve as default};
