import{j as e}from"./ui-vendor-BpIggZZ9.js";import{b as t}from"./react-vendor-C7VPsBAG.js";import{P as F,C as h,f as m,g as j,h as x,i as p,I as w,B as n,a9 as b,m as D,Y as k,a5 as I,r as R}from"./index-Bshoxa3b.js";import{D as M,a as q,b as B,c as $,d as H,e as K}from"./dialog-B4soTW2z.js";import{P as O}from"./plus-CIXQeA2Y.js";import{M as G}from"./minus-CRP8eWos.js";import"./utils-vendor-BUCX3MvZ.js";function X(){const{toast:r}=F(),[l,N]=t.useState(""),[i,U]=t.useState(""),[v,A]=t.useState(""),[E,c]=t.useState(!1),[a,T]=t.useState("add"),[d,f]=t.useState(""),[u,y]=t.useState(""),g=async()=>{if(!l.trim()){r({title:"Error",description:"Please enter a username to search",variant:"destructive"});return}try{const s=await fetch(`/api/admin/users/search?q=${encodeURIComponent(l)}`,{credentials:"include"});if(!s.ok)throw new Error("User not found");const S=await s.json();if(S.length===0){r({title:"Not Found",description:"No user found with that username",variant:"destructive"});return}const o=S[0];U(o.id),A(o.username),r({title:"User Found",description:`User: ${o.username} (Balance: ${o.currencyBalance||0} coins)`})}catch(s){r({title:"Error",description:s.message||"Failed to search user",variant:"destructive"})}},P=async()=>{if(!i){r({title:"Error",description:"Please select a user first",variant:"destructive"});return}if(!d||parseInt(d)<=0){r({title:"Error",description:"Please enter a valid amount",variant:"destructive"});return}if(!u.trim()){r({title:"Error",description:"Please provide a reason for this adjustment",variant:"destructive"});return}try{await I("POST",a==="add"?"/api/currency/admin/add":"/api/currency/admin/deduct",{userId:i,amount:parseInt(d),reason:u}),R.invalidateQueries({queryKey:["/api/currency/balance"]}),c(!1),f(""),y(""),r({title:"Success",description:`Currency ${a==="add"?"added":"deducted"} successfully`})}catch(s){r({title:"Error",description:s.message||"Failed to adjust currency",variant:"destructive"})}},C=s=>{if(!i){r({title:"Error",description:"Please search and select a user first",variant:"destructive"});return}T(s),c(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"User Currency Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manually adjust user currency balances"})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"Search User"}),e.jsx(x,{children:"Find a user by username to manage their currency"})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(w,{placeholder:"Enter username...",value:l,onChange:s=>N(s.target.value),onKeyDown:s=>s.key==="Enter"&&g()})}),e.jsxs(n,{onClick:g,children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Search"]})]})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"Selected User"}),e.jsxs(x,{children:["User: ",v]})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(n,{onClick:()=>C("add"),className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Add Currency"]}),e.jsxs(n,{onClick:()=>C("deduct"),variant:"destructive",className:"flex-1",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Deduct Currency"]})]})})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"Recent Transactions"}),e.jsx(x,{children:"View currency transaction history for this user"})]}),e.jsx(p,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction history will appear here. Use the admin panel to view full details."})})]})]}),e.jsx(M,{open:E,onOpenChange:c,children:e.jsxs(q,{children:[e.jsxs(B,{children:[e.jsxs($,{children:[a==="add"?"Add":"Deduct"," Currency"]}),e.jsxs(H,{children:[a==="add"?"Grant":"Remove"," currency ",a==="add"?"to":"from"," user: ",v]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"amount",children:"Amount"}),e.jsx(w,{id:"amount",type:"number",placeholder:"Enter amount",value:d,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"reason",children:"Reason"}),e.jsx(k,{id:"reason",placeholder:"Provide a reason for this adjustment...",value:u,onChange:s=>y(s.target.value),rows:3})]})]}),e.jsxs(K,{children:[e.jsx(n,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(n,{onClick:P,children:[a==="add"?"Add":"Deduct"," Currency"]})]})]})})]})}export{X as default};
