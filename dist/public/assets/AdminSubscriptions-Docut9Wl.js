import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as G,b as h}from"./react-vendor-C7VPsBAG.js";import{u as Z,P as _,ah as ee,b as se,d as v,B as o,a8 as ae,a0 as ie,C as F,f as ne,g as te,h as re,p as C,i as k,a3 as ce,T as le,m as t,I as c,Y as B}from"./index-Bshoxa3b.js";import{D as E,a as U,b as T,c as q,d as A,e as M}from"./dialog-B4soTW2z.js";import{S as I,a as L,b as R,c as O,d as x}from"./select-DT_5i3rD.js";import{C as X}from"./crown-DnGdiNOO.js";import{P as H}from"./plus-CIXQeA2Y.js";import{S as oe}from"./square-pen-C7u-hRzu.js";import"./utils-vendor-BUCX3MvZ.js";function ye(){const{isAdmin:N,isAuthenticated:b}=Z(),[,S]=G(),{toast:d}=_(),p=ee(),[Q,u]=h.useState(!1),[V,m]=h.useState(!1),[w,P]=h.useState(null),[a,n]=h.useState({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0"}),{data:g,isLoading:J}=se({queryKey:["/api/admin/subscriptions"],queryFn:async()=>{const s=await fetch("/api/admin/subscriptions",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch packages");return s.json()},enabled:N&&b});async function j(){const s=await fetch("/api/csrf-token",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch CSRF token");return(await s.json()).csrfToken}const f=v({mutationFn:async s=>{const i=await j(),r=await fetch("/api/admin/subscriptions",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-csrf-token":i},credentials:"include",body:JSON.stringify(s)});if(!r.ok){const l=await r.json();throw new Error(l.message||"Failed to create package")}return r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),d({title:"Success",description:"Subscription package created successfully"}),u(!1),D()},onError:s=>{d({title:"Error",description:s.message,variant:"destructive"})}}),y=v({mutationFn:async({id:s,data:i})=>{const r=await j(),l=await fetch(`/api/admin/subscriptions/${s}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-csrf-token":r},credentials:"include",body:JSON.stringify(i)});if(!l.ok){const $=await l.json();throw new Error($.message||"Failed to update package")}return l.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),d({title:"Success",description:"Subscription package updated successfully"}),m(!1),P(null),D()},onError:s=>{d({title:"Error",description:s.message,variant:"destructive"})}}),K=v({mutationFn:async s=>{const i=await j(),r=await fetch(`/api/admin/subscriptions/${s}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest","x-csrf-token":i},credentials:"include"});if(!r.ok){const l=await r.json();throw new Error(l.message||"Failed to delete package")}return r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),d({title:"Success",description:"Subscription package deleted successfully"})},onError:s=>{d({title:"Error",description:s.message,variant:"destructive"})}}),D=()=>{n({name:"",description:"",priceUSD:"",billingCycle:"monthly",features:"",coinBonus:"0",discountPercentage:"0"})},z=()=>{const s=a.features.split(`
`).filter(i=>i.trim());f.mutate({...a,priceUSD:a.priceUSD,coinBonus:parseInt(a.coinBonus),discountPercentage:parseInt(a.discountPercentage),features:s})},W=s=>{P(s);const i=typeof s.features=="string"?JSON.parse(s.features):s.features;n({name:s.name,description:s.description||"",priceUSD:s.priceUSD,billingCycle:s.billingCycle,features:Array.isArray(i)?i.join(`
`):"",coinBonus:s.coinBonus.toString(),discountPercentage:s.discountPercentage.toString()}),m(!0)},Y=()=>{if(!w)return;const s=a.features.split(`
`).filter(i=>i.trim());y.mutate({id:w.id,data:{...a,priceUSD:a.priceUSD,coinBonus:parseInt(a.coinBonus),discountPercentage:parseInt(a.discountPercentage),features:s}})};return!b||!N?(S("/"),null):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>S("/admin"),children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[e.jsx(X,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"}),"VIP Subscription Management"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage subscription tiers and pricing"})]})]}),e.jsxs(o,{onClick:()=>u(!0),className:"w-full sm:w-auto",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Create Package"]})]}),J?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx(ie,{className:"h-64"},s))}):g&&g.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g.map(s=>{const i=typeof s.features=="string"?JSON.parse(s.features):s.features;return e.jsxs(F,{className:"bg-card/80 backdrop-blur-md border-border/50",children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(te,{className:"text-xl",children:s.name}),e.jsx(re,{className:"mt-1",children:s.description})]}),e.jsx(C,{variant:"secondary",className:"ml-2",children:s.billingCycle})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold",children:["$",s.priceUSD]}),e.jsxs("span",{className:"text-muted-foreground",children:["/",s.billingCycle]})]}),Array.isArray(i)&&i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Features:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[i.slice(0,3).map((r,l)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-3 h-3 text-primary"}),r]},l)),i.length>3&&e.jsxs("li",{className:"text-xs",children:["+",i.length-3," more..."]})]})]}),e.jsxs("div",{className:"flex gap-2 text-sm",children:[e.jsxs(C,{variant:"outline",children:["+",s.coinBonus," coins"]}),s.discountPercentage>0&&e.jsxs(C,{variant:"outline",children:[s.discountPercentage,"% off"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>W(s),className:"flex-1",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs(o,{variant:"destructive",size:"sm",onClick:()=>K.mutate(s.id),className:"flex-1",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Delete"]})]})]})]},s.id)})}):e.jsx(F,{children:e.jsxs(k,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No subscription packages found"}),e.jsxs(o,{onClick:()=>u(!0),className:"mt-4",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Create First Package"]})]})})]}),e.jsx(E,{open:Q,onOpenChange:u,children:e.jsxs(U,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(q,{children:"Create Subscription Package"}),e.jsx(A,{children:"Add a new VIP subscription tier"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"name",children:"Package Name *"}),e.jsx(c,{id:"name",value:a.name,onChange:s=>n({...a,name:s.target.value}),placeholder:"Premium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"priceUSD",children:"Price (USD) *"}),e.jsx(c,{id:"priceUSD",type:"number",step:"0.01",value:a.priceUSD,onChange:s=>n({...a,priceUSD:s.target.value}),placeholder:"9.99"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"description",children:"Description"}),e.jsx(c,{id:"description",value:a.description,onChange:s=>n({...a,description:s.target.value}),placeholder:"Best for regular readers"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"billingCycle",children:"Billing Cycle"}),e.jsxs(I,{value:a.billingCycle,onValueChange:s=>n({...a,billingCycle:s}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsxs(O,{children:[e.jsx(x,{value:"monthly",children:"Monthly"}),e.jsx(x,{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"coinBonus",children:"Coin Bonus"}),e.jsx(c,{id:"coinBonus",type:"number",value:a.coinBonus,onChange:s=>n({...a,coinBonus:s.target.value}),placeholder:"100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"discountPercentage",children:"Discount %"}),e.jsx(c,{id:"discountPercentage",type:"number",value:a.discountPercentage,onChange:s=>n({...a,discountPercentage:s.target.value}),placeholder:"10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"features",children:"Features (one per line)"}),e.jsx(B,{id:"features",value:a.features,onChange:s=>n({...a,features:s.target.value}),placeholder:`Ad-free reading
Early access to new chapters
Exclusive content`,rows:5})]})]}),e.jsxs(M,{children:[e.jsx(o,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(o,{onClick:z,disabled:f.isPending,children:f.isPending?"Creating...":"Create Package"})]})]})}),e.jsx(E,{open:V,onOpenChange:m,children:e.jsxs(U,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(q,{children:"Edit Subscription Package"}),e.jsx(A,{children:"Update package details"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-name",children:"Package Name *"}),e.jsx(c,{id:"edit-name",value:a.name,onChange:s=>n({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-priceUSD",children:"Price (USD) *"}),e.jsx(c,{id:"edit-priceUSD",type:"number",step:"0.01",value:a.priceUSD,onChange:s=>n({...a,priceUSD:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-description",children:"Description"}),e.jsx(c,{id:"edit-description",value:a.description,onChange:s=>n({...a,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-billingCycle",children:"Billing Cycle"}),e.jsxs(I,{value:a.billingCycle,onValueChange:s=>n({...a,billingCycle:s}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsxs(O,{children:[e.jsx(x,{value:"monthly",children:"Monthly"}),e.jsx(x,{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-coinBonus",children:"Coin Bonus"}),e.jsx(c,{id:"edit-coinBonus",type:"number",value:a.coinBonus,onChange:s=>n({...a,coinBonus:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-discountPercentage",children:"Discount %"}),e.jsx(c,{id:"edit-discountPercentage",type:"number",value:a.discountPercentage,onChange:s=>n({...a,discountPercentage:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"edit-features",children:"Features (one per line)"}),e.jsx(B,{id:"edit-features",value:a.features,onChange:s=>n({...a,features:s.target.value}),rows:5})]})]}),e.jsxs(M,{children:[e.jsx(o,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(o,{onClick:Y,disabled:y.isPending,children:y.isPending?"Updating...":"Update Package"})]})]})})]})}export{ye as default};
