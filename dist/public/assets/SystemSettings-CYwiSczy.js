import{j as e}from"./ui-vendor-BpIggZZ9.js";import{u as ie,b as u,L as ne}from"./react-vendor-C7VPsBAG.js";import{c as re,u as le,ah as ce,b as oe,d as E,L as F,C as T,i as A,B as p,a8 as de,a6 as X,af as B,m as x,e as H,f as ue,g as he,p as q,h as me,T as z,I as O,Y as xe,aa as pe,t as h}from"./index-Bshoxa3b.js";import{D as J,f as ge,a as je,b as fe,c as ye,d as ve}from"./dialog-B4soTW2z.js";import{A as be,a as Ne,b as Se,c as we,d as Ce,e as ke,f as De,g as Pe}from"./alert-dialog-ckVHmtNn.js";import{S as M,a as L,b as I,c as V,d as o}from"./select-DT_5i3rD.js";import{T as Ee,a as Fe,b as S,c as Te}from"./tabs-72BErqnU.js";import{A as Ae}from"./AdIntensityControl-CpQnfzYC.js";import{P as qe}from"./plus-CIXQeA2Y.js";import{G as K}from"./globe-WU3sxzli.js";import{U as Q}from"./users-q6XJjClA.js";import{E as Oe}from"./eye-QF1-RHmE.js";import{E as Me}from"./eye-off-5pfH6nJe.js";import{S as Le}from"./square-pen-C7u-hRzu.js";import{S as Ie}from"./save-B39N0M5_.js";import"./utils-vendor-BUCX3MvZ.js";import"./chart-column-DGETuS3s.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=re("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);async function Ve(){const i=await fetch("/api/admin/settings",{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error("Failed to fetch settings");return i.json()}async function Re(i,n,r){const d=await fetch(`/api/admin/settings/${i}/${n}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)});if(!d.ok){const g=await d.json().catch(()=>({message:"Failed to save setting"}));throw new Error(g.message||"Failed to save setting")}return d.json()}async function Ue(i,n){const r=await fetch(`/api/admin/settings/by-id/${i}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(n)});if(!r.ok){const d=await r.json().catch(()=>({message:"Failed to update setting"}));throw new Error(d.message||"Failed to update setting")}return r.json()}async function Xe(i){const n=await fetch(`/api/admin/settings/${i}`,{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok){const r=await n.json().catch(()=>({message:"Failed to delete setting"}));throw new Error(r.message||"Failed to delete setting")}}function rs(){const{isAdmin:i,isAuthenticated:n}=le(),[,r]=ie(),d=ce(),[g,j]=u.useState(!1),[W,f]=u.useState(!1),[m,y]=u.useState(null),[v,w]=u.useState(null),[_,G]=u.useState("site"),[C,Z]=u.useState(!1),[t,l]=u.useState({category:"site",key:"",value:"",type:"string",description:"",isPublic:!1});u.useEffect(()=>{(!n||!i)&&r("/")},[n,i,r]);const{data:R,isLoading:Y,error:U}=oe({queryKey:["admin-settings"],queryFn:Ve,enabled:i&&n}),k=E({mutationFn:({category:s,key:a,data:c})=>Re(s,a,c),onSuccess:()=>{d.invalidateQueries({queryKey:["admin-settings"]}),h({title:"Success",description:"Setting saved successfully"}),j(!1),b()},onError:s=>{h({title:"Error",description:s.message||"Failed to save setting",variant:"destructive"})}}),D=E({mutationFn:({id:s,data:a})=>Ue(s,a),onSuccess:()=>{d.invalidateQueries({queryKey:["admin-settings"]}),h({title:"Success",description:"Setting updated successfully"}),f(!1),y(null),b()},onError:s=>{h({title:"Error",description:s.message||"Failed to update setting",variant:"destructive"})}}),P=E({mutationFn:Xe,onSuccess:()=>{d.invalidateQueries({queryKey:["admin-settings"]}),h({title:"Success",description:"Setting deleted successfully"}),w(null)},onError:s=>{h({title:"Error",description:s.message||"Failed to delete setting",variant:"destructive"})}}),b=()=>{l({category:"site",key:"",value:"",type:"string",description:"",isPublic:!1})},ee=s=>{y(s),l({category:s.category,key:s.key,value:s.value,type:s.type,description:s.description||"",isPublic:s.isPublic}),f(!0)},se=s=>{s.preventDefault();let a=t.value;try{switch(t.type){case"number":if(a=Number(t.value),isNaN(a)){h({title:"Invalid Value",description:"Please enter a valid number",variant:"destructive"});return}break;case"boolean":a=t.value==="true"||t.value===!0;break;case"json":typeof t.value=="string"&&JSON.parse(t.value);break}}catch{h({title:"Invalid Value",description:"Please enter a valid value for the selected type",variant:"destructive"});return}const c={...t,value:a};m?D.mutate({id:m.id,data:c}):k.mutate({category:c.category,key:c.key,data:c})},te=(s,a)=>{switch(a){case"boolean":return s==="true"?"✓ True":"✗ False";case"json":try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}default:return s.length>50?`${s.substring(0,50)}...`:s}},ae=s=>{switch(s){case"site":return e.jsx(K,{className:"h-4 w-4"});case"users":return e.jsx(Q,{className:"h-4 w-4"});case"content":return e.jsx(H,{className:"h-4 w-4"});case"system":return e.jsx($,{className:"h-4 w-4"});default:return e.jsx(X,{className:"h-4 w-4"})}},N=s=>{if(!R)return[];const a=R.filter(c=>c.category===s);return C?a.filter(c=>c.isPublic):a};return!n||!i?null:Y?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})})}):U?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(T,{children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center text-red-600",children:["Error loading settings: ",U.message]})})})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ne,{href:"/admin",children:e.jsxs(p,{variant:"ghost",size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back to Admin"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold",children:"System Settings"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(J,{open:g,onOpenChange:j,children:e.jsx(ge,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Add Setting"]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{id:"show-public",checked:C,onCheckedChange:Z}),e.jsx(x,{htmlFor:"show-public",className:"text-sm",children:"Show only public settings"})]})]})}),e.jsxs(Ee,{value:_,onValueChange:G,children:[e.jsxs(Fe,{className:"grid w-full grid-cols-4",children:[e.jsxs(S,{value:"site",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Site"]}),e.jsxs(S,{value:"users",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Users"]}),e.jsxs(S,{value:"content",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Content"]}),e.jsxs(S,{value:"system",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"System"]})]}),["site","users","content","system"].map(s=>e.jsxs(Te,{value:s,className:"space-y-4",children:[s==="system"&&e.jsx(Ae,{}),e.jsxs(T,{children:[e.jsxs(ue,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ae(s),e.jsxs(he,{className:"capitalize",children:[s," Settings"]})]}),e.jsxs(q,{variant:"secondary",children:[N(s).length," setting",N(s).length!==1?"s":""]})]}),e.jsxs(me,{children:["Manage ",s," configuration settings"]})]}),e.jsx(A,{children:N(s).length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No ",C?"public ":"",s," settings found"]}):e.jsx("div",{className:"space-y-3",children:N(s).map(a=>e.jsx(T,{className:"border",children:e.jsx(A,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{variant:"outline",className:"text-xs",children:a.type}),e.jsxs(q,{variant:a.isPublic?"default":"secondary",className:"text-xs",children:[a.isPublic?e.jsx(Oe,{className:"h-3 w-3 mr-1"}):e.jsx(Me,{className:"h-3 w-3 mr-1"}),a.isPublic?"Public":"Private"]})]}),e.jsx("h4",{className:"font-semibold text-sm mb-1",children:a.key}),a.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:a.description}),e.jsx("div",{className:"bg-gray-50 p-2 rounded text-sm font-mono",children:te(a.value,a.type)})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>ee(a),children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>w(a),children:e.jsx(z,{className:"h-4 w-4 text-red-600"})})]})]})})},a.id))})})]})]},s))]}),e.jsx(J,{open:g||W,onOpenChange:s=>{s||(j(!1),f(!1),y(null),b())},children:e.jsxs(je,{className:"sm:max-w-[425px]",children:[e.jsxs(fe,{children:[e.jsx(ye,{children:m?"Edit Setting":"Add New Setting"}),e.jsx(ve,{children:m?"Update the setting configuration":"Create a new system setting"})]}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"category",children:"Category"}),e.jsxs(M,{value:t.category,onValueChange:s=>l({...t,category:s}),disabled:!!m,children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Select category"})}),e.jsxs(V,{children:[e.jsx(o,{value:"site",children:"Site"}),e.jsx(o,{value:"users",children:"Users"}),e.jsx(o,{value:"content",children:"Content"}),e.jsx(o,{value:"system",children:"System"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"type",children:"Type"}),e.jsxs(M,{value:t.type,onValueChange:s=>l({...t,type:s}),children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Select type"})}),e.jsxs(V,{children:[e.jsx(o,{value:"string",children:"String"}),e.jsx(o,{value:"number",children:"Number"}),e.jsx(o,{value:"boolean",children:"Boolean"}),e.jsx(o,{value:"json",children:"JSON"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"key",children:"Key"}),e.jsx(O,{id:"key",value:t.key,onChange:s=>l({...t,key:s.target.value}),placeholder:"e.g., site_name, max_upload_size",disabled:!!m,required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"value",children:"Value"}),t.type==="json"?e.jsx(xe,{id:"value",value:t.value,onChange:s=>l({...t,value:s.target.value}),placeholder:'{"key": "value"}',rows:4,required:!0}):t.type==="boolean"?e.jsxs(M,{value:String(t.value),onValueChange:s=>l({...t,value:s}),children:[e.jsx(L,{children:e.jsx(I,{placeholder:"Select boolean value"})}),e.jsxs(V,{children:[e.jsx(o,{value:"true",children:"True"}),e.jsx(o,{value:"false",children:"False"})]})]}):e.jsx(O,{id:"value",type:t.type==="number"?"number":"text",value:t.value,onChange:s=>l({...t,value:s.target.value}),placeholder:"Enter value",required:!0})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(O,{id:"description",value:t.description,onChange:s=>l({...t,description:s.target.value}),placeholder:"Brief description of this setting"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{id:"isPublic",checked:t.isPublic,onCheckedChange:s=>l({...t,isPublic:s})}),e.jsx(x,{htmlFor:"isPublic",children:"Public setting (visible to non-admins)"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsxs(p,{type:"button",variant:"outline",onClick:()=>{j(!1),f(!1),y(null),b()},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(p,{type:"submit",disabled:k.isPending||D.isPending,children:[k.isPending||D.isPending?e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ie,{className:"h-4 w-4 mr-2"}),m?"Update":"Create"]})]})]})]})}),e.jsx(be,{open:!!v,onOpenChange:()=>w(null),children:e.jsxs(Ne,{children:[e.jsxs(Se,{children:[e.jsx(we,{children:"Delete Setting"}),e.jsxs(Ce,{children:['Are you sure you want to delete the setting "',v?.key,'"? This action cannot be undone and may affect system functionality.']})]}),e.jsxs(ke,{children:[e.jsx(De,{children:"Cancel"}),e.jsxs(Pe,{onClick:()=>{v&&P.mutate(v.id)},className:"bg-red-600 hover:bg-red-700",disabled:P.isPending,children:[P.isPending?e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]})}export{rs as default};
